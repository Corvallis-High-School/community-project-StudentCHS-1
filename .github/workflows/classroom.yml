name: Autograding Tests

on:
  push:
  workflow_dispatch:
  repository_dispatch:
    types: []  # Accept all event types

permissions:
  checks: write
  actions: read
  contents: read

jobs:
  run-autograding-tests:
    runs-on: ubuntu-latest
    if: github.actor != 'github-classroom[bot]'
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up JDK 17
        uses: actions/setup-java@v3
        with:
          java-version: '17'
          distribution: 'temurin'

      - name: Download JUnit
        run: |
          mkdir -p lib
          wget https://repo1.maven.org/maven2/org/junit/jupiter/junit-jupiter-api/5.10.1/junit-jupiter-api-5.10.1.jar -O lib/junit-jupiter-api-5.10.1.jar
          wget https://repo1.maven.org/maven2/org/junit/jupiter/junit-jupiter-engine/5.10.1/junit-jupiter-engine-5.10.1.jar -O lib/junit-jupiter-engine-5.10.1.jar
          wget https://repo1.maven.org/maven2/org/junit/platform/junit-platform-console-standalone/1.10.1/junit-platform-console-standalone-1.10.1.jar -O lib/junit-platform-console-standalone-1.10.1.jar

      - name: Compile Java source
        run: |
          javac -cp ".:lib/junit-jupiter-api-5.10.1.jar" *.java

      - name: R1 - Instance Variables
        id: r1-instance-variables
        uses: classroom-resources/autograding-command-grader@v1
        with:
          test-name: R1 - Instance Variables
          setup-command: ''
          command: java -jar lib/junit-platform-console-standalone-1.10.1.jar --class-path .:lib/junit-jupiter-api-5.10.1.jar --select-method CommunityProjectTest#testInstanceVariables
          timeout: 10
          max-score: 3

      - name: R2 - Constructor
        id: r2-constructor
        uses: classroom-resources/autograding-command-grader@v1
        with:
          test-name: R2 - Constructor
          setup-command: ''
          command: java -jar lib/junit-platform-console-standalone-1.10.1.jar --class-path .:lib/junit-jupiter-api-5.10.1.jar --select-method CommunityProjectTest#testConstructorExists
          timeout: 10
          max-score: 3

      - name: R3 - Print Method
        id: r3-print-method
        uses: classroom-resources/autograding-command-grader@v1
        with:
          test-name: R3 - Print Method
          setup-command: ''
          command: java -jar lib/junit-platform-console-standalone-1.10.1.jar --class-path .:lib/junit-jupiter-api-5.10.1.jar --select-method CommunityProjectTest#testPrintMethodExists
          timeout: 10
          max-score: 3

      - name: R4 - Accessor Methods
        id: r4-accessor-methods
        uses: classroom-resources/autograding-command-grader@v1
        with:
          test-name: R4 - Accessor Methods
          setup-command: ''
          command: java -jar lib/junit-platform-console-standalone-1.10.1.jar --class-path .:lib/junit-jupiter-api-5.10.1.jar --select-method CommunityProjectTest#testGetterMethodsExist
          timeout: 10
          max-score: 3

      - name: R5 - Mutator Methods
        id: r5-mutator-methods
        uses: classroom-resources/autograding-command-grader@v1
        with:
          test-name: R5 - Mutator Methods
          setup-command: ''
          command: java -jar lib/junit-platform-console-standalone-1.10.1.jar --class-path .:lib/junit-jupiter-api-5.10.1.jar --select-method CommunityProjectTest#testSetterMethodsExist
          timeout: 10
          max-score: 3

      - name: R6 - toString Method
        id: r6-tostring-method
        uses: classroom-resources/autograding-command-grader@v1
        with:
          test-name: R6 - toString Method
          setup-command: ''
          command: java -jar lib/junit-platform-console-standalone-1.10.1.jar --class-path .:lib/junit-jupiter-api-5.10.1.jar --select-method CommunityProjectTest#testToStringMethodExists
          timeout: 10
          max-score: 3

      - name: R7 - Additional Method
        id: r7-additional-method
        uses: classroom-resources/autograding-command-grader@v1
        with:
          test-name: R7 - Additional Method
          setup-command: ''
          command: java -jar lib/junit-platform-console-standalone-1.10.1.jar --class-path .:lib/junit-jupiter-api-5.10.1.jar --select-method CommunityProjectTest#testAdditionalMethodExists
          timeout: 10
          max-score: 2

      - name: R8 - Main Method Testing
        id: r8-main-method
        uses: classroom-resources/autograding-command-grader@v1
        with:
          test-name: R8 - Main Method Testing
          setup-command: ''
          command: java -jar lib/junit-platform-console-standalone-1.10.1.jar --class-path .:lib/junit-jupiter-api-5.10.1.jar --select-method CommunityProjectTest#testMainMethodExists
          timeout: 10
          max-score: 10

      - name: Autograding Reporter
        uses: classroom-resources/autograding-grading-reporter@v1
        env:
          R1-INSTANCE-VARIABLES_RESULTS: "${{steps.r1-instance-variables.outputs.result}}"
          R2-CONSTRUCTOR_RESULTS: "${{steps.r2-constructor.outputs.result}}"
          R3-PRINT-METHOD_RESULTS: "${{steps.r3-print-method.outputs.result}}"
          R4-ACCESSOR-METHODS_RESULTS: "${{steps.r4-accessor-methods.outputs.result}}"
          R5-MUTATOR-METHODS_RESULTS: "${{steps.r5-mutator-methods.outputs.result}}"
          R6-TOSTRING-METHOD_RESULTS: "${{steps.r6-tostring-method.outputs.result}}"
          R7-ADDITIONAL-METHOD_RESULTS: "${{steps.r7-additional-method.outputs.result}}"
          R8-MAIN-METHOD_RESULTS: "${{steps.r8-main-method.outputs.result}}"
        with:
          runners: r1-instance-variables,r2-constructor,r3-print-method,r4-accessor-methods,r5-mutator-methods,r6-tostring-method,r7-additional-method,r8-main-method
